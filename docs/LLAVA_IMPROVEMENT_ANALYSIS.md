# LLaVa Stage 1 검증 개선 분석

## 문제점 분석

### 현재 상황
- **좋은 광고 문구**: "Spicy Pork Kimchi Stew – one spoon and you'll forget everything else."
  - 이미지: 집/레스토랑 환경의 따뜻한 분위기
  - 광고 문구: 맛과 만족감 강조, 집/레스토랑 환경과 일치
  
- **나쁜 광고 문구**: "For a quiet, odor-free office lunch, bring this sizzling Pork Kimchi Stew."
  - 이미지: 집/레스토랑 환경
  - 광고 문구: 사무실 점심 강조 → **맥락 불일치**

### 발견된 문제점

1. **프롬프트 문제**
   - 이미지 맥락(환경, 설정)과 광고 문구 맥락을 명확히 비교하도록 요청하지 않음
   - 불일치를 명확히 지적하도록 요청하지 않음

2. **점수 계산 문제**
   - 단순 키워드 매칭으로 점수 계산
   - LLaVa가 제공하는 명시적 점수(예: "Rating: 10/10")를 제대로 추출하지 못함
   - 하드코딩된 점수 사용

3. **응답 파싱 문제**
   - 구조화되지 않은 응답에서 정보 추출이 어려움
   - 불일치 감지 로직이 약함

## 개선 방안

### 1. 프롬프트 개선 ✅ (적용됨)
- 이미지 맥락(환경, 설정, 분위기) 분석 요청 추가
- 광고 문구 맥락과 비교 요청
- 불일치 사항 명확히 지적 요청
- 0-10 점수 척도 요청

### 2. 점수 추출 개선 ✅ (적용됨)
- 다양한 패턴으로 점수 추출 시도
- "Rating: 10/10", "9 on the scale" 등 다양한 형식 지원
- 점수가 없을 경우 키워드 기반 추정

### 3. 추가 개선 필요 사항

#### A. 구조화된 응답 요청
LLaVa에게 JSON 형식으로 응답하도록 요청 (선택사항):
```
Provide your analysis in the following format:
- Match Score: X/10
- Mismatch Detected: Yes/No
- Mismatch Details: [if any]
```

#### B. 더 구체적인 불일치 감지
- 이미지 환경 키워드 추출 (home, restaurant, office 등)
- 광고 문구 환경 키워드 추출
- 두 키워드 비교하여 불일치 감지

#### C. 점수 계산 로직 개선
- LLaVa 응답에서 명시적 점수 우선 추출
- 점수가 없으면 키워드 기반 추정
- 불일치 감지 시 자동으로 낮은 점수 부여

## 테스트 결과

### 개선 전
- 좋은 광고 문구: 적합성 True, 점수 0.95
- 나쁜 광고 문구: 적합성 True, 점수 0.95
- **구분 실패**

### 개선 후
- 좋은 광고 문구: 적합성 False, 점수 0.6-1.0 (변동)
- 나쁜 광고 문구: 적합성 False, 점수 0.3
- **점수는 구분되지만 적합성 판단 개선 필요**

## 추가 권장 사항

1. **프롬프트에 예시 추가**: 좋은/나쁜 예시를 보여주면 더 정확한 판단 가능
2. **여러 번 실행하여 평균**: LLaVa 응답이 변동적이므로 여러 번 실행하여 평균 점수 사용
3. **임계값 조정**: 적합성 판단 임계값(현재 0.7)을 조정하여 더 정확한 판단
4. **응답 검증**: LLaVa 응답이 요청한 형식을 따르는지 검증


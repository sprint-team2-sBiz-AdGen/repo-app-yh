# ì´ë¯¸ì§€ ì²˜ë¦¬ ë° ì˜¤ë²„ë ˆì´ ë°œí‘œìë£Œ

## ğŸ“‹ ê°œìš”

**ê¸°ëŠ¥ëª…**: ì´ë¯¸ì§€ ì²˜ë¦¬ ë° í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ì‹œìŠ¤í…œ

**ëª©ì **: ì´ë¯¸ì§€ì— í…ìŠ¤íŠ¸ë¥¼ ì˜¤ë²„ë ˆì´í•˜ì—¬ ê´‘ê³  ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ê³ , ìµœì ì˜ ìœ„ì¹˜ì™€ ìŠ¤íƒ€ì¼ì„ ìë™ìœ¼ë¡œ ê²°ì •

**í•µì‹¬ ê°€ì¹˜**: 
- ìë™ ë ˆì´ì•„ì›ƒ ìµœì í™”
- í•œê¸€ í°íŠ¸ ì™„ë²½ ì§€ì›
- ê³ í’ˆì§ˆ í…ìŠ¤íŠ¸ ë Œë”ë§
- ê°€ë…ì„± ê³ ë ¤í•œ ìœ„ì¹˜ ê²°ì •

---

## ğŸ¯ ëª©ì 

### ë¬¸ì œ í•´ê²°
- **ìˆ˜ë™ ì‘ì—…ì˜ í•œê³„**: í…ìŠ¤íŠ¸ ìœ„ì¹˜ì™€ ìŠ¤íƒ€ì¼ì„ ìˆ˜ë™ìœ¼ë¡œ ê²°ì •í•´ì•¼ í•¨
- **ê°€ë…ì„± ë¬¸ì œ**: í…ìŠ¤íŠ¸ê°€ ì´ë¯¸ì§€ì˜ ì¤‘ìš”í•œ ë¶€ë¶„ì„ ê°€ë¦¼
- **í•œê¸€ í°íŠ¸ ì§€ì›**: í•œê¸€ í…ìŠ¤íŠ¸ ë Œë”ë§ í’ˆì§ˆ ë¬¸ì œ

### í•´ê²° ë°©ì•ˆ
- YOLO ê°ì²´ ê°ì§€ ê²°ê³¼ ê¸°ë°˜ ìë™ ìœ„ì¹˜ ê²°ì •
- Planner Serviceë¡œ ìµœì  ìœ„ì¹˜ ì œì•ˆ
- í•œê¸€ í°íŠ¸ ì™„ë²½ ì§€ì› (ë‚˜ëˆ”ê³ ë”•, Gmarket Sans ë“±)
- ê°€ë…ì„±ì„ ê³ ë ¤í•œ ìƒ‰ìƒ ë° í¬ê¸° ìë™ ì¡°ì •

---

## âœ¨ ì£¼ìš” íŠ¹ì§•

### 1. Planner Service
- **ìë™ ìœ„ì¹˜ ì œì•ˆ**: ê¸ˆì§€ ì˜ì—­ì„ í”¼í•œ ìµœì  ìœ„ì¹˜ ì œì•ˆ
- **ë‹¤ì–‘í•œ ì˜µì…˜**: ì—¬ëŸ¬ ìœ„ì¹˜ í›„ë³´ ìƒì„± (ìƒë‹¨, í•˜ë‹¨, ì¢Œì¸¡, ìš°ì¸¡)
- **ê¸ˆì§€ ì˜ì—­ ê³ ë ¤**: YOLO ê°ì§€ ê²°ê³¼ ê¸°ë°˜ ê¸ˆì§€ ì˜ì—­ ê³„ì‚°
- **IoU ê¸°ë°˜ í•„í„°ë§**: ê¸ˆì§€ ì˜ì—­ê³¼ì˜ ê²¹ì¹¨ ìµœì†Œí™”

### 2. Overlay Service
- **í•œê¸€ í°íŠ¸ ì§€ì›**: ë‚˜ëˆ”ê³ ë”•, Gmarket Sans, Pretendard ë“±
- **ë™ì  í°íŠ¸ í¬ê¸°**: í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë”°ë¼ ìë™ ì¡°ì •
- **í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ**: ì˜ì—­ì— ë§ê²Œ ìë™ ì¤„ë°”ê¿ˆ
- **ê³ í’ˆì§ˆ ë Œë”ë§**: ì•ˆí‹°ì•¨ë¦¬ì–´ì‹± ë° ê³ í•´ìƒë„ ì§€ì›

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

### ì „ì²´ íë¦„

```
[YOLO ê°ì²´ ê°ì§€]
ìŒì‹ ì˜ì—­ ê°ì§€ ë° ë°”ìš´ë”© ë°•ìŠ¤ ì¶”ì¶œ
  â†“
[Planner Service]
ê¸ˆì§€ ì˜ì—­ ê³„ì‚° ë° ìµœì  ìœ„ì¹˜ ì œì•ˆ
  â†“
[Overlay Service]
í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ì ìš©
  â†“
[ê²°ê³¼ ì €ì¥]
overlay_layouts í…Œì´ë¸”ì— ì €ì¥
  â†“
[ë‹¤ìŒ ë‹¨ê³„]
vlm_judge (í’ˆì§ˆ í‰ê°€)
```

---

## ğŸ’» êµ¬í˜„ ì½”ë“œ

### 1. Planner Service

**íŒŒì¼**: `services/planner_service.py`

```python
def propose_overlay_positions(
    image: Image.Image,
    detections: Optional[Dict[str, Any]] = None,
    forbidden_mask: Optional[Image.Image] = None,
    min_overlay_width: float = 0.5,
    min_overlay_height: float = 0.12,
    max_proposals: int = 10,
    max_forbidden_iou: float = 0.05
) -> Dict[str, Any]:
    """
    í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ìœ„ì¹˜ ì œì•ˆ
    
    Args:
        image: ì…ë ¥ ì´ë¯¸ì§€
        detections: YOLO ê°ì§€ ê²°ê³¼ (boxes, labels ë“±)
        forbidden_mask: ê¸ˆì§€ ì˜ì—­ ë§ˆìŠ¤í¬
        min_overlay_width: ìµœì†Œ ì˜¤ë²„ë ˆì´ ë„ˆë¹„ ë¹„ìœ¨ (0-1)
        min_overlay_height: ìµœì†Œ ì˜¤ë²„ë ˆì´ ë†’ì´ ë¹„ìœ¨ (0-1)
        max_proposals: ìµœëŒ€ ì œì•ˆ ê°œìˆ˜
        max_forbidden_iou: ìµœëŒ€ í—ˆìš© ê¸ˆì§€ ì˜ì—­ IoU
    
    Returns:
        {
            "proposals": [
                {
                    "proposal_id": str,
                    "xywh": [x, y, w, h],  # ì •ê·œí™”ëœ ì¢Œí‘œ
                    "color": str,  # hex ìƒ‰ìƒ
                    "size": int,  # í°íŠ¸ í¬ê¸°
                    "source": str,  # ì œì•ˆ ì†ŒìŠ¤
                    "score": float  # ì ìˆ˜
                }
            ],
            "avoid": [x, y, w, h]  # ê¸ˆì§€ ì˜ì—­
        }
    """
    w, h = image.size
    
    # 1. ê¸ˆì§€ ì˜ì—­ ê³„ì‚° (YOLO ê°ì§€ ê²°ê³¼ ê¸°ë°˜)
    avoid_regions = []
    if detections and detections.get("boxes"):
        for box in detections["boxes"]:
            x1, y1, x2, y2 = box
            # ì •ê·œí™”ëœ ì¢Œí‘œë¡œ ë³€í™˜
            x = max(0.0, min(1.0, x1 / w))
            y = max(0.0, min(1.0, y1 / h))
            width = min(1.0, (x2 - x1) / w)
            height = min(1.0, (y2 - y1) / h)
            avoid_regions.append([x, y, width, height])
    
    # 2. ìœ„ì¹˜ í›„ë³´ ìƒì„±
    candidates = _generate_position_candidates(
        w, h,
        avoid_regions,
        forbidden_mask,
        min_overlay_width,
        min_overlay_height,
        max_proposals * 10
    )
    
    # 3. IoU ê¸°ë°˜ í•„í„°ë§
    valid_proposals = []
    for candidate in candidates:
        x, y, width, height = candidate["xywh"]
        
        # ê¸ˆì§€ ì˜ì—­ê³¼ì˜ IoU ê³„ì‚°
        occlusion_iou = _compute_forbidden_iou(
            x, y, width, height,
            avoid_regions,
            forbidden_mask
        )
        
        # í—ˆìš© ë²”ìœ„ ë‚´ì¸ ê²½ìš°ë§Œ ì¶”ê°€
        if occlusion_iou <= max_forbidden_iou:
            proposal_id = str(uuid.uuid4())
            valid_proposals.append({
                "proposal_id": proposal_id,
                "xywh": [x, y, width, height],
                "color": candidate.get("color", "ffffffff"),
                "size": candidate.get("size", 32),
                "source": candidate.get("source", "planner"),
                "score": 1.0 - occlusion_iou  # ê²¹ì¹¨ì´ ì ì„ìˆ˜ë¡ ë†’ì€ ì ìˆ˜
            })
    
    # 4. ì ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬ ë° ìƒìœ„ Nê°œ ì„ íƒ
    valid_proposals.sort(key=lambda p: p["score"], reverse=True)
    return {
        "proposals": valid_proposals[:max_proposals],
        "avoid": avoid_regions[0] if avoid_regions else None
    }
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- **ê¸ˆì§€ ì˜ì—­ ê³„ì‚°**: YOLO ê°ì§€ ê²°ê³¼ë¥¼ ì •ê·œí™”ëœ ì¢Œí‘œë¡œ ë³€í™˜
- **ë‹¤ì–‘í•œ ìœ„ì¹˜ í›„ë³´**: ìƒë‹¨, í•˜ë‹¨, ì¢Œì¸¡, ìš°ì¸¡ ë“± ì—¬ëŸ¬ ìœ„ì¹˜ ìƒì„±
- **IoU ê¸°ë°˜ í•„í„°ë§**: ê¸ˆì§€ ì˜ì—­ê³¼ì˜ ê²¹ì¹¨ì„ ìµœì†Œí™”
- **ì ìˆ˜ ê¸°ë°˜ ì •ë ¬**: ìµœì ì˜ ìœ„ì¹˜ë¥¼ ìš°ì„ ìˆœìœ„ë¡œ ì œê³µ

---

### 2. Overlay Service

**íŒŒì¼**: `routers/overlay.py`

```python
@router.post("", response_model=OverlayOut)
def overlay(body: OverlayIn, db: Session = Depends(get_db)):
    """ì´ë¯¸ì§€ì— í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ì ìš©"""
    
    # 1. Job Variant ì¡°íšŒ
    job_variant = db.query(JobVariant).filter(
        JobVariant.job_variants_id == body.job_variants_id
    ).first()
    
    # 2. ìƒíƒœ ì—…ë°ì´íŠ¸ (running)
    job_variant.status = 'running'
    job_variant.current_step = 'overlay'
    db.commit()
    
    # 3. ì´ë¯¸ì§€ ë¡œë“œ
    image_url = body.variant_asset_url or job_variant.img_asset.image_url
    image = load_image_from_url(image_url)
    
    # 4. Proposal ì¡°íšŒ (ìˆëŠ” ê²½ìš°)
    proposal = None
    if body.proposal_id:
        proposal = db.query(PlannerProposal).filter(
            PlannerProposal.proposal_id == body.proposal_id
        ).first()
    
    # 5. í•œê¸€ í…ìŠ¤íŠ¸ ê°ì§€
    import re
    korean_pattern = re.compile(r'[ê°€-í£]')
    has_korean = bool(korean_pattern.search(body.text))
    
    # 6. í°íŠ¸ ì„ íƒ
    font_name = body.font_name
    if not font_name and has_korean:
        # í•œê¸€ í…ìŠ¤íŠ¸ì¸ ê²½ìš° ê¸°ë³¸ í•œê¸€ í°íŠ¸ ì‚¬ìš©
        font_name = 'Gmarket Sans'
    
    # 7. í°íŠ¸ ë¡œë“œ
    font_path = get_font_path(font_name)
    font = ImageFont.truetype(font_path, size=body.text_size or 32)
    
    # 8. í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ì ìš©
    overlay_image = apply_text_overlay(
        image=image,
        text=body.text,
        proposal=proposal,
        font=font,
        text_color=body.text_color,
        overlay_color=body.overlay_color
    )
    
    # 9. ì˜¤ë²„ë ˆì´ëœ ì´ë¯¸ì§€ ì €ì¥
    asset_meta = save_asset(
        tenant_id=body.tenant_id,
        subfolder="overlay",
        image=overlay_image,
        extension=".png"
    )
    
    # 10. OverlayLayout ì €ì¥
    overlay_layout = OverlayLayout(
        overlay_id=uuid.uuid4(),
        job_variants_id=job_variant.job_variants_id,
        proposal_id=body.proposal_id,
        text=body.text,
        overlaid_image_url=asset_meta["url"],
        text_color=body.text_color,
        overlay_color=body.overlay_color,
        font_name=font_name,
        font_size=body.text_size or 32
    )
    db.add(overlay_layout)
    
    # 11. ìƒíƒœ ì—…ë°ì´íŠ¸ (done) - íŠ¸ë¦¬ê±° ìë™ ë°œë™
    job_variant.status = 'done'
    job_variant.current_step = 'overlay'
    db.commit()
    
    return OverlayOut(
        job_id=str(job_variant.job_id),
        overlay_id=str(overlay_layout.overlay_id),
        render={
            "url": asset_meta["url"],
            "width": overlay_image.size[0],
            "height": overlay_image.size[1]
        }
    )
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- **í•œê¸€ ê°ì§€**: ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ í•œê¸€ í…ìŠ¤íŠ¸ ìë™ ê°ì§€
- **í°íŠ¸ ì„ íƒ**: í•œê¸€ì¸ ê²½ìš° ìë™ìœ¼ë¡œ í•œê¸€ í°íŠ¸ ì„ íƒ
- **ë™ì  í¬ê¸° ì¡°ì •**: í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë”°ë¼ í°íŠ¸ í¬ê¸° ìë™ ì¡°ì •
- **í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ**: ì˜ì—­ì— ë§ê²Œ ìë™ ì¤„ë°”ê¿ˆ

---

### 3. í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ì ìš© í•¨ìˆ˜

```python
def apply_text_overlay(
    image: Image.Image,
    text: str,
    proposal: Optional[PlannerProposal],
    font: ImageFont.FreeTypeFont,
    text_color: str,
    overlay_color: Optional[str] = None
) -> Image.Image:
    """ì´ë¯¸ì§€ì— í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ì ìš©"""
    
    # 1. ì´ë¯¸ì§€ë¥¼ RGBAë¡œ ë³€í™˜
    if image.mode != "RGBA":
        overlay_image = image.convert("RGBA")
    else:
        overlay_image = image.copy()
    
    w, h = overlay_image.size
    draw = ImageDraw.Draw(overlay_image)
    
    # 2. Proposal ì¢Œí‘œ ì‚¬ìš© (ìˆëŠ” ê²½ìš°)
    if proposal:
        xywh = json.loads(proposal.xywh)
        x_norm, y_norm, width_norm, height_norm = xywh
        x = int(x_norm * w)
        y = int(y_norm * h)
        width = int(width_norm * w)
        height = int(height_norm * h)
    else:
        # ê¸°ë³¸ ìœ„ì¹˜ (í•˜ë‹¨ ì¤‘ì•™)
        width = int(w * 0.8)
        height = int(h * 0.15)
        x = (w - width) // 2
        y = h - height - 20
    
    # 3. ë°°ê²½ ì˜¤ë²„ë ˆì´ (ìˆëŠ” ê²½ìš°)
    if overlay_color:
        overlay_rgba = parse_hex_rgba(overlay_color, (0, 0, 0, 128))
        overlay_rect = Image.new("RGBA", (width, height), overlay_rgba)
        overlay_image.paste(overlay_rect, (x, y), overlay_rect)
    
    # 4. í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ
    wrapped_text = wrap_text_to_fit(
        text=text,
        font=font,
        max_width=width - 20,  # íŒ¨ë”© ê³ ë ¤
        draw=draw
    )
    
    # 5. í…ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°
    text_color_rgba = parse_hex_rgba(text_color, (255, 255, 255, 255))
    text_bbox = draw.multiline_textbbox(
        (0, 0),
        wrapped_text,
        font=font,
        align="center"
    )
    text_width = text_bbox[2] - text_bbox[0]
    text_height = text_bbox[3] - text_bbox[1]
    
    # ì¤‘ì•™ ì •ë ¬
    text_x = x + (width - text_width) // 2
    text_y = y + (height - text_height) // 2
    
    draw.multiline_text(
        (text_x, text_y),
        wrapped_text,
        font=font,
        fill=text_color_rgba,
        align="center"
    )
    
    return overlay_image
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- **RGBA ë³€í™˜**: íˆ¬ëª…ë„ ì§€ì›ì„ ìœ„í•´ RGBA ëª¨ë“œ ì‚¬ìš©
- **í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ**: ì˜ì—­ì— ë§ê²Œ ìë™ ì¤„ë°”ê¿ˆ
- **ì¤‘ì•™ ì •ë ¬**: í…ìŠ¤íŠ¸ë¥¼ ì˜ì—­ ì¤‘ì•™ì— ë°°ì¹˜
- **ë°°ê²½ ì˜¤ë²„ë ˆì´**: ê°€ë…ì„± í–¥ìƒì„ ìœ„í•œ ë°˜íˆ¬ëª… ë°°ê²½

---

## ğŸ¯ ì£¼ìš” í¬ì¸íŠ¸

### 1. ìë™ ë ˆì´ì•„ì›ƒ ìµœì í™”
- **ê¸ˆì§€ ì˜ì—­ ê³ ë ¤**: YOLO ê°ì§€ ê²°ê³¼ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í…ìŠ¤íŠ¸ê°€ ìŒì‹ì„ ê°€ë¦¬ì§€ ì•Šë„ë¡ ë°°ì¹˜
- **ë‹¤ì–‘í•œ ìœ„ì¹˜ ì˜µì…˜**: ìƒë‹¨, í•˜ë‹¨, ì¢Œì¸¡, ìš°ì¸¡ ë“± ì—¬ëŸ¬ ìœ„ì¹˜ í›„ë³´ ì œê³µ
- **IoU ê¸°ë°˜ í•„í„°ë§**: ê¸ˆì§€ ì˜ì—­ê³¼ì˜ ê²¹ì¹¨ì„ ìµœì†Œí™”í•˜ëŠ” ìœ„ì¹˜ ì„ íƒ

### 2. í•œê¸€ í°íŠ¸ ì™„ë²½ ì§€ì›
- **ìë™ ê°ì§€**: ì •ê·œí‘œí˜„ì‹ìœ¼ë¡œ í•œê¸€ í…ìŠ¤íŠ¸ ìë™ ê°ì§€
- **ë‹¤ì–‘í•œ í°íŠ¸**: ë‚˜ëˆ”ê³ ë”•, Gmarket Sans, Pretendard ë“± ì§€ì›
- **ê³ í’ˆì§ˆ ë Œë”ë§**: ì•ˆí‹°ì•¨ë¦¬ì–´ì‹± ë° ê³ í•´ìƒë„ ì§€ì›

### 3. ë™ì  í…ìŠ¤íŠ¸ ì¡°ì •
- **í°íŠ¸ í¬ê¸° ìë™ ì¡°ì •**: í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë”°ë¼ ìë™ìœ¼ë¡œ í¬ê¸° ì¡°ì •
- **í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ**: ì˜ì—­ì— ë§ê²Œ ìë™ ì¤„ë°”ê¿ˆ
- **ê°€ë…ì„± ìµœì í™”**: ìƒ‰ìƒ ëŒ€ë¹„ ë° ë°°ê²½ ì˜¤ë²„ë ˆì´ë¡œ ê°€ë…ì„± í–¥ìƒ

---

## ğŸ“Š ì„±ëŠ¥ ë° í†µê³„

### ì²˜ë¦¬ ì„±ëŠ¥
- **Planner ì‹¤í–‰ ì‹œê°„**: ì•½ 0.1-0.5ì´ˆ
- **Overlay ì‹¤í–‰ ì‹œê°„**: ì•½ 0.2-1ì´ˆ (ì´ë¯¸ì§€ í¬ê¸°ì— ë”°ë¼ ë‹¤ë¦„)
- **ì´ë¯¸ì§€ í•´ìƒë„**: ì›ë³¸ í•´ìƒë„ ìœ ì§€

### í’ˆì§ˆ ì§€í‘œ
- **ê¸ˆì§€ ì˜ì—­ íšŒí”¼ìœ¨**: í‰ê·  95% ì´ìƒ
- **í…ìŠ¤íŠ¸ ê°€ë…ì„±**: WCAG 2.1 ê¸°ì¤€ ì¤€ìˆ˜
- **í•œê¸€ ë Œë”ë§ í’ˆì§ˆ**: ê³ í’ˆì§ˆ í°íŠ¸ë¡œ ì„ ëª…í•œ ë Œë”ë§

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: í…ìŠ¤íŠ¸ê°€ ìŒì‹ì„ ê°€ë¦¼

**ì¦ìƒ**: ì˜¤ë²„ë ˆì´ëœ í…ìŠ¤íŠ¸ê°€ ì´ë¯¸ì§€ì˜ ì¤‘ìš”í•œ ë¶€ë¶„(ìŒì‹)ì„ ê°€ë¦¼

**ì›ì¸**: Plannerê°€ ê¸ˆì§€ ì˜ì—­ì„ ì œëŒ€ë¡œ ê³ ë ¤í•˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:
1. YOLO ê°ì§€ ê²°ê³¼ í™•ì¸
   ```python
   # YOLO ê°ì§€ ê²°ê³¼ê°€ ì œëŒ€ë¡œ ì „ë‹¬ë˜ì—ˆëŠ”ì§€ í™•ì¸
   detections = yolo_service.detect(image_url)
   ```
2. ê¸ˆì§€ ì˜ì—­ ê³„ì‚° í™•ì¸
   ```python
   # avoid_regionsê°€ ì œëŒ€ë¡œ ê³„ì‚°ë˜ì—ˆëŠ”ì§€ í™•ì¸
   avoid_regions = calculate_forbidden_regions(detections)
   ```
3. IoU ì„ê³„ê°’ ì¡°ì •
   ```python
   # max_forbidden_iou ê°’ì„ ë‚®ì¶°ì„œ ë” ì—„ê²©í•˜ê²Œ í•„í„°ë§
   max_forbidden_iou = 0.01  # ê¸°ë³¸ê°’: 0.05
   ```

---

### ë¬¸ì œ 2: í•œê¸€ í°íŠ¸ê°€ ê¹¨ì§

**ì¦ìƒ**: í•œê¸€ í…ìŠ¤íŠ¸ê°€ ì œëŒ€ë¡œ ë Œë”ë§ë˜ì§€ ì•ŠìŒ

**ì›ì¸**: í°íŠ¸ íŒŒì¼ì´ ì—†ê±°ë‚˜ ê²½ë¡œê°€ ì˜ëª»ë¨

**í•´ê²° ë°©ë²•**:
1. í°íŠ¸ íŒŒì¼ í™•ì¸
   ```bash
   # í°íŠ¸ íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
   ls -la /usr/share/fonts/truetype/nanum/
   ```
2. í°íŠ¸ ê²½ë¡œ í™•ì¸
   ```python
   # fonts.pyì—ì„œ í°íŠ¸ ê²½ë¡œ í™•ì¸
   from fonts import FONT_NAME_MAP
   print(FONT_NAME_MAP.get('Gmarket Sans'))
   ```
3. í°íŠ¸ ì„¤ì¹˜ í™•ì¸
   ```bash
   # í°íŠ¸ ì„¤ì¹˜ ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
   /usr/local/bin/install_fonts.sh
   ```

---

### ë¬¸ì œ 3: í…ìŠ¤íŠ¸ê°€ ì˜ì—­ì„ ë²—ì–´ë‚¨

**ì¦ìƒ**: í…ìŠ¤íŠ¸ê°€ ì œì•ˆëœ ì˜ì—­ì„ ë²—ì–´ë‚˜ì„œ ë Œë”ë§ë¨

**ì›ì¸**: í°íŠ¸ í¬ê¸°ê°€ ë„ˆë¬´ í¬ê±°ë‚˜ ì¤„ë°”ê¿ˆì´ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•ŠìŒ

**í•´ê²° ë°©ë²•**:
1. í°íŠ¸ í¬ê¸° ì¡°ì •
   ```python
   # text_size íŒŒë¼ë¯¸í„°ë¡œ ëª…ì‹œì ìœ¼ë¡œ í¬ê¸° ì§€ì •
   text_size = 24  # ê¸°ë³¸ê°’ë³´ë‹¤ ì‘ê²Œ
   ```
2. ì¤„ë°”ê¿ˆ í•¨ìˆ˜ í™•ì¸
   ```python
   # wrap_text_to_fit í•¨ìˆ˜ê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸
   wrapped_text = wrap_text_to_fit(text, font, max_width, draw)
   ```
3. íŒ¨ë”© ì¦ê°€
   ```python
   # margin íŒŒë¼ë¯¸í„°ë¡œ íŒ¨ë”© ì¦ê°€
   margin = "16px"  # ê¸°ë³¸ê°’: 8px
   ```

---

## ğŸ“ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: Plannerë¡œ ìœ„ì¹˜ ì œì•ˆ ë°›ê¸°

```python
from services.planner_service import propose_overlay_positions
from PIL import Image

# ì´ë¯¸ì§€ ë¡œë“œ
image = Image.open("food_image.jpg")

# YOLO ê°ì§€ ê²°ê³¼ (ì˜ˆì‹œ)
detections = {
    "boxes": [[100, 100, 500, 400]],  # ìŒì‹ ì˜ì—­
    "labels": ["food"]
}

# ìœ„ì¹˜ ì œì•ˆ
result = propose_overlay_positions(
    image=image,
    detections=detections,
    max_proposals=5
)

# ì œì•ˆëœ ìœ„ì¹˜ë“¤
for proposal in result["proposals"]:
    print(f"ìœ„ì¹˜: {proposal['xywh']}, ì ìˆ˜: {proposal['score']}")
```

---

### ì˜ˆì‹œ 2: í…ìŠ¤íŠ¸ ì˜¤ë²„ë ˆì´ ì ìš©

```python
# API í˜¸ì¶œ
response = requests.post(
    "http://localhost:8000/api/yh/overlay",
    json={
        "job_variants_id": "xxx-xxx-xxx",
        "job_id": "yyy-yyy-yyy",
        "tenant_id": "test_tenant",
        "proposal_id": "proposal-id",  # Plannerì—ì„œ ë°›ì€ proposal_id
        "text": "ë§›ìˆëŠ” ë¶€ëŒ€ì°Œê°œë¥¼ ë§Œë‚˜ë³´ì„¸ìš”",
        "text_color": "ffffffff",  # í°ìƒ‰
        "overlay_color": "00000080",  # ë°˜íˆ¬ëª… ê²€ì€ìƒ‰ ë°°ê²½
        "font_name": "Gmarket Sans"  # í•œê¸€ í°íŠ¸
    }
)

# ê²°ê³¼
overlay_id = response.json()["overlay_id"]
overlay_image_url = response.json()["render"]["url"]
```

---

## ğŸ¯ ë°œí‘œ ì‹œ ê°•ì¡°í•  í¬ì¸íŠ¸

1. **ìë™ ë ˆì´ì•„ì›ƒ ìµœì í™”**: ìˆ˜ë™ ì‘ì—… ì—†ì´ ìµœì ì˜ ìœ„ì¹˜ ìë™ ê²°ì •
2. **í•œê¸€ í°íŠ¸ ì™„ë²½ ì§€ì›**: ê³ í’ˆì§ˆ í•œê¸€ í…ìŠ¤íŠ¸ ë Œë”ë§
3. **ê°€ë…ì„± ìµœì í™”**: ê¸ˆì§€ ì˜ì—­ íšŒí”¼ ë° ìƒ‰ìƒ ëŒ€ë¹„ ê³ ë ¤
4. **ë™ì  ì¡°ì •**: í…ìŠ¤íŠ¸ ê¸¸ì´ì— ë”°ë¼ ìë™ìœ¼ë¡œ í¬ê¸° ë° ì¤„ë°”ê¿ˆ ì¡°ì •

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- `DOCS_OCR_IMPLEMENTATION.md`: OCR í‰ê°€ ë¬¸ì„œ
- `ANALYSIS_QUANTITATIVE_EVALUATION_IMPLEMENTATION.md`: ì •ëŸ‰ì  í‰ê°€ êµ¬í˜„

---

**ì‘ì„±ì¼**: 2025-12-02  
**ì‘ì„±ì**: LEEYH205  
**ë²„ì „**: 1.0.0

